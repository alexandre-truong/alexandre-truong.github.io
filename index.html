<!DOCTYPE html>
<head>
    <html>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>

        <script>
            let vidArray = ['src/vid1-1.gif', 'src/vid1-4.gif', 'src/vid1-2.gif', 'src/vid1-3.gif'];
        </script>

        <div class="step" id="step-0">
            <div class="container">
                <h1>Bienvenue ! </h1>
                <p>Vous voici sur le site de l'expérience. </p>
                <p>Remplissez dès à présent le numéro d'expérience <span>%GROUPID%</span> dans la première question du questionnaire, et revenez sur cet onglet.</p>
                <p>Lorsque vous êtes prêts, cliquez sur "continuer".</p>
                <button onclick="nextStep()">Continuer</button>
            </div>
        </div>

        <div class="step" id="step-1">
            <h2>Choisissez une qualité de streaming</h2>
            <div style='display: flex'>
                <div data-video="1" data-id="A" class="vid-container" style='flex:1'>
                    <img class="preview" src="src/vid1-1.gif">
                    <div class="overlay">
                        <div class='background'></div>
                        <div class='instruction'>CLIQUER POUR VISIONNER</div>
                    </div>
                </div>
                <div data-video="4" data-id="D" class="vid-container" style='flex:1'>
                    <img class="preview" src="src/vid1-4.gif">
                    <div class="overlay">
                        <div class='background'></div>
                        <div class='instruction'>CLIQUER POUR VISIONNER</div>
                    </div>
                </div>
            </div>
            <div style='display: flex'>
                <div data-video="2" data-id="B" class="vid-container" style='flex:1'>
                    <img class="preview" src="src/vid1-2.gif">
                    <div class="overlay">
                        <div class='background'></div>
                        <div class='instruction'>CLIQUER POUR VISIONNER</div>
                    </div>
                </div>
                <div data-video="3" data-id="C" class="vid-container" style='flex:1'>
                    <img class="preview" src="src/vid1-3.gif">
                    <div class="overlay">
                        <div class='background'></div>
                        <div class='instruction'>CLIQUER POUR VISIONNER</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="step" id="step-2">
            <video preload="metadata" class="player">
                <source src="src/vid1-1.mov" type="video/mp4">
                Il semblerait que votre lecteur ne supporte pas les vidéos :-(
            </video>
            <video preload="metadata" class="player">
                <source src="src/vid1-2.mov" type="video/mp4">
                Il semblerait que votre lecteur ne supporte pas les vidéos :-(
            </video>
            <video preload="metadata" class="player">
                <source src="src/vid1-3.mov" type="video/mp4">
                Il semblerait que votre lecteur ne supporte pas les vidéos :-(
            </video>
            <video preload="metadata" class="player">
                <source src="src/vid1-4.mov" type="video/mp4">
                Il semblerait que votre lecteur ne supporte pas les vidéos :-(
            </video>
        </div>
        
        <div class="step" id="step-3">
            <div class="container">
                <h1>Question time</h1>
                <p>Merci de répondre à la première partie du questionnaire.</p>
                <p>Remplissez l'identifiant de votre choix de vidéo <span>%CHOICEID%</span> dans la question 2 et répondez aux questions 3 et 4.</p>
                <p>Une fois cela fait, vous pouvez poursuivre en cliquant sur le bouton "continuer".</p>
                <button onclick="nextStep()">Continuer</button>
            </div>
        </div>

        <div class="step" id="step-4">
            <h2>Choisissez une qualité de streaming</h2>
            <div style='display: flex'>
                <div data-video="1" data-id="A" class="vid-container" style='flex:1'>
                    <img class="preview" src="src/vid2-1.gif">
                    <div class="overlay">
                        <div class='background'></div>
                        <div class='instruction'>CLIQUER POUR VISIONNER</div>
                        <img  class='indicator' src="src/indicator%GROUP%-1.png"></img>
                    </div>
                </div>
                <div data-video="4" data-id="D" class="vid-container" style='flex:1'>
                    <img class="preview" src="src/vid2-4.gif">
                    <div class="overlay">
                        <div class='background'></div>
                        <div class='instruction'>CLIQUER POUR VISIONNER</div>
                        <img  class='indicator' src="src/indicator%GROUP%-4.png"></img>
                    </div>
                </div>
            </div>
            <div style='display: flex'>
                <div data-video="2" data-id="B" class="vid-container" style='flex:1'>
                    <img class="preview" src="src/vid2-2.gif">
                    <div class="overlay">
                        <div class='background'></div>
                        <div class='instruction'>CLIQUER POUR VISIONNER</div>
                        <img  class='indicator' src="src/indicator%GROUP%-2.png"></img>
                    </div>
                </div>
                <div data-video="3" data-id="C" class="vid-container" style='flex:1'>
                    <img class="preview" src="src/vid2-3.gif">
                    <div class="overlay">
                        <div class='background'></div>
                        <div class='instruction'>CLIQUER POUR VISIONNER</div>
                        <img  class='indicator' src="src/indicator%GROUP%-3.png"></img>
                    </div>
                </div>
            </div>
        </div>

        <div class="step" id="step-5">
            <video preload="metadata" class="player">
                <source src="src/vid2-1.mov" type="video/mp4">
                Il semblerait que votre lecteur ne supporte pas les vidéos :-(
            </video>
            <video preload="metadata" class="player">
                <source src="src/vid2-2.mov" type="video/mp4">
                Il semblerait que votre lecteur ne supporte pas les vidéos :-(
            </video>
            <video preload="metadata" class="player">
                <source src="src/vid2-3.mov" type="video/mp4">
                Il semblerait que votre lecteur ne supporte pas les vidéos :-(
            </video>
            <video preload="metadata" class="player">
                <source src="src/vid2-4.mov" type="video/mp4">
                Il semblerait que votre lecteur ne supporte pas les vidéos :-(
            </video>
        </div>

        <div class="step" id="step-6">
            <div class="container">
                <h1>Question time</h1>
                <p>Vous pouvez remplir la dernière partie du questionnaire.</p>
                <p>Remplissez l'identifiant de votre choix <span>%CHOICEID%</span> dans la question 2 et répondez aux questions suivantes.</p>
                <button onclick="nextStep()">Continuer</button>
            </div>
        </div>

        <div class="step" id="step-7">
            <div class="container">
                <h1>Merci !</h1>
                <p>Merci d'avoir pris le temps de faire cette expérience ! </p>
                <p>Vous pouvez fermer cet onglet et finir de répondre au questionnaire si ce n'est pas déjà fait.</p>
            </div>
        </div>

        <script>

            var step = 0;
            var groupId = null;
            var id = "";
            var choiceId = null;

            function preloadImage(url) {
                var _img = new Image();
                _img.src = url;
            }
            
            function preloadVideo(url) {
                var _img = new Image();
                _img.src = url;
            }

            function nextStep () {
                $(`#step-${step}`).hide();
                step ++;
                $(`#step-${step}`).show();
            }

            $(document).ready(() => {
                $('.overlay').hide();
                $('.step').hide();

                groupId = Math.floor(Math.random()*4);
                document.getElementById('step-0').innerHTML = document.getElementById('step-0').innerHTML.replace('%GROUPID%', groupId);
                $('#step-0').show();
                if(groupId != 0) {
                    $('.indicator').each((i, elt) => {
                        var src = elt.src;
                        elt.src = src.replace('%GROUP%', groupId);
                    })
                }
            })

            $('.vid-container').each((i, elt) => {
                elt.addEventListener('mouseover', () => {
                    var elt2 = $(elt).find('.overlay').show();
                })
                elt.addEventListener('mouseleave', () => {
                    var elt2 = $(elt).find('.overlay').hide();
                })
                elt.addEventListener('click', () => {
                    id = $(elt).attr("data-video");
                    console.log("id= ", id)
                    var player = $(`#step-${step+1} video`)[id-1];
                    console.log("player: ", player);
                    $(player).show();
                    player.play();
                    player.addEventListener('ended', () => {
                        nextStep();
                    })
                    choiceId = $(elt).attr("data-id");
                    document.getElementById(`step-${step+2}`).innerHTML = document.getElementById(`step-${step+2}`).innerHTML.replace('%CHOICEID%', choiceId);
                    nextStep();

                    // var duration = 0;
                    // switch(step) {
                    //     case 2: duration = 20000;
                    //     break;
                    //     case 5: duration = 30000;
                    // }
                    // console.log("duration ", duration );
                    // setTimeout(() => {
                    //     nextStep();
                    // }, duration);
                })
            })
            
        </script>

    </body>
</html>